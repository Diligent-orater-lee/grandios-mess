import{$ as a,C as c,T as u,X as m,d as h,ec as p,kc as k,mc as o,nc as d,oc as R,pc as S,q as l,qc as I,rc as f}from"./chunk-DVSZTQYN.js";var A=`${f.apiUrl}/auth/refresh`,g=class t{http=a(p);apiUrl=f.apiUrl;constructor(){}login(r){return this.http.post(`${this.apiUrl}/auth/login`,r).pipe(u(()=>{}),c(s=>(console.error("Login error:",s),l(()=>s))))}register(r){return this.http.post(`${this.apiUrl}/auth/register`,r).pipe(u(()=>{}),c(s=>(console.error("Registration error:",s),l(()=>s))))}refresh(r){return this.http.post(A,{refresh_token:r})}adminRegister(r){return this.http.post(`${this.apiUrl}/auth/register`,r).pipe(u(()=>{}),c(s=>(console.error("Admin registration error:",s),l(()=>s))))}static \u0275fac=function(s){return new(s||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})};function _(t,r){switch(t){case"CLIENT":r.navigate(["/"]);break;case"ADMIN":case"DELIVERY":r.navigate(["/clients"]);break;default:r.navigate(["/"]);break}}function b(t,r,s){switch(t){case"CLIENT":r!=="/"&&r!==""&&s.navigate(["/"]);break;case"ADMIN":case"DELIVERY":r!=="/clients"&&r!=="/"&&r!==""&&s.navigate(["/clients"]);break}}var T={user:null,accessToken:null,isAuthenticated:!1,loading:!1,error:null},F=d({providedIn:"root"},I(T),S(t=>{let r=a(g),s=a(k);return{login(n){o(t,{loading:!0,error:null}),r.login(n).subscribe({next:e=>{localStorage.setItem("refresh_token",e.refresh_token),localStorage.setItem("auth_user",JSON.stringify(e.user)),sessionStorage.setItem("access_token",e.access_token),o(t,{user:e.user,accessToken:e.access_token,isAuthenticated:!0,loading:!1,error:null}),console.log("Login successful, navigating based on user type..."),_(e.user.userType,s)},error:e=>{o(t,{loading:!1,error:e.error?.message||"Login failed"})}})},register(n){o(t,{loading:!0,error:null}),r.register(n).subscribe({next:e=>{localStorage.setItem("refresh_token",e.refresh_token),localStorage.setItem("auth_user",JSON.stringify(e.user)),sessionStorage.setItem("access_token",e.access_token),o(t,{user:e.user,accessToken:e.access_token,isAuthenticated:!0,loading:!1,error:null}),console.log("Registration successful, navigating based on user type..."),_(e.user.userType,s)},error:e=>{o(t,{loading:!1,error:e.error?.message||"Registration failed"})}})},logout(){localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),sessionStorage.removeItem("access_token"),o(t,{user:null,accessToken:null,isAuthenticated:!1,loading:!1,error:null})},clearError(){o(t,{error:null})},initializeAuth(){return h(this,null,function*(){let n=localStorage.getItem("auth_user"),e=n?JSON.parse(n):null,i=sessionStorage.getItem("access_token");if(i&&sessionStorage.setItem("access_token",i),o(t,{user:e,isAuthenticated:!!i,loading:!1}),e&&i){let v=s.url;b(e.userType,v,s)}})},getAccessToken(){return t.accessToken()},refreshUsingStoredToken(){return h(this,null,function*(){let n=localStorage.getItem("refresh_token");if(!n)return null;try{let e=yield r.refresh(n).toPromise();return e?(localStorage.setItem("refresh_token",e.refresh_token),localStorage.setItem("auth_user",JSON.stringify(e.user)),sessionStorage.setItem("access_token",e.access_token),o(t,{user:e.user,accessToken:e.access_token,isAuthenticated:!0}),e.access_token):null}catch{return localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),sessionStorage.removeItem("access_token"),o(t,{user:null,accessToken:null,isAuthenticated:!1}),null}})}}}),R({onInit(t){t.initializeAuth()}}));export{A as a,g as b,F as c};
