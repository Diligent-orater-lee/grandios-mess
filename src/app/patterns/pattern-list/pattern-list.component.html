@if (loading()) {
  <div class="loading-container">
    <mat-spinner diameter="32"></mat-spinner>
    <p>Loading patterns...</p>
  </div>
}

@if (error()) {
  <mat-card appearance="outlined" class="error-card">
    <mat-card-content>
      <div class="error-content">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ error() }}</span>
      </div>
    </mat-card-content>
  </mat-card>
}

@if (!loading() && !error() && !hasPatterns()) {
  <mat-card appearance="outlined" class="empty-state">
    <mat-card-content>
      <div class="empty-content">
        <mat-icon>pattern</mat-icon>
        <h3>No Patterns Found</h3>
        <p>Create your first meal pattern to get started with automated meal scheduling.</p>
        <button mat-raised-button color="primary" (click)="onCreateNew()">
          <mat-icon>add</mat-icon>
          Create First Pattern
        </button>
      </div>
    </mat-card-content>
  </mat-card>
}

@if (!loading() && !error() && hasPatterns()) {
  <div class="patterns-container">
    <!-- Active Patterns -->
    @if (activePatterns().length > 0) {
      <div class="patterns-section">
        <h3 class="section-title">
          <mat-icon>check_circle</mat-icon>
          Active Patterns ({{ activePatterns().length }})
        </h3>
        <div class="patterns-grid">
          @for (pattern of activePatterns(); track pattern.id) {
            <mat-card appearance="outlined" class="pattern-card active">
              <mat-card-header>
                <mat-card-title>{{ pattern.name }}</mat-card-title>
                <mat-card-subtitle>
                  <mat-chip-set>
                    <mat-chip [color]="'primary'">
                      {{ getPatternKindLabel(pattern.rule.kind) }}
                    </mat-chip>
                  </mat-chip-set>
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <div class="pattern-description">
                  {{ getPatternDescription(pattern) }}
                </div>

                <div class="pattern-dates">
                  <mat-icon>schedule</mat-icon>
                  {{ getDateRangeText(pattern) }}
                </div>

                <div class="pattern-meals">
                  @for (meal of pattern.rule.meals; track meal) {
                    <mat-chip [color]="'accent'">
                      <mat-icon>restaurant</mat-icon>
                      {{ getMealTypeLabel(meal) }}
                    </mat-chip>
                  }
                </div>
              </mat-card-content>

              <mat-card-actions>
                <button mat-icon-button [matMenuTriggerFor]="menu" [matTooltip]="'More actions'">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="onEdit(pattern)">
                    <mat-icon>edit</mat-icon>
                    Edit
                  </button>
                  <button mat-menu-item (click)="onDelete(pattern.id)" class="delete-action">
                    <mat-icon>delete</mat-icon>
                    Delete
                  </button>
                </mat-menu>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      </div>
    }

    <!-- Create New Button -->
    <div class="create-button-container">
      <button mat-fab color="primary" (click)="onCreateNew()" [matTooltip]="'Create new pattern'">
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>
}
