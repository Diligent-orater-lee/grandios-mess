import{b as w}from"./chunk-TFRYWLHQ.js";import{c as s}from"./chunk-33FUOUKU.js";import{G as f,P as g,W as k,_ as l,dc as b,g as p,la as M,lc as r,mc as I,nc as W,oc as S,pc as O,qc as y,t as d,u as h,z as m}from"./chunk-7KD5NMWA.js";var c=class e{http=l(b);apiUrl=y.apiUrl;getMonth(n){let t={year:n.year,month:n.month,weekStartsOn:n.weekStartsOn};return n.userId&&(t.userId=n.userId),this.http.post(`${this.apiUrl}/calendar/month`,t)}getWeek(n,t){let a={startDateISO:n};return t&&(a.userId=t),this.http.get(`${this.apiUrl}/calendar/week`,{params:a})}toggleMeal(n){return this.http.post(`${this.apiUrl}/calendar/toggle`,n)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"})};var v=new Date,C={view:"month",loading:!1,weekStartsOn:0,currentMonth:{year:v.getFullYear(),month:v.getMonth()},monthData:void 0,weekData:void 0,currentWeekStartISO:void 0,selectedUserId:void 0},H=I(O(C),S(e=>{let n=l(c);return{setView(t){r(e,{view:t})},setMonth(t,a){r(e,{currentMonth:{year:t,month:a}})},setWeekStartISO(t){r(e,{currentWeekStartISO:t})},setWeekStartsOn(t){r(e,{weekStartsOn:t})},setSelectedUserId:s(d(t=>{r(e,{selectedUserId:t})})),loadMonth(){let t=e.currentMonth(),a=e.weekStartsOn(),o=e.selectedUserId();r(e,{loading:!0});let u={year:t.year,month:t.month,weekStartsOn:a,userId:o};n.getMonth(u).subscribe({next:i=>{r(e,{monthData:i.data,loading:!1})},error:i=>{r(e,{loading:!1}),console.error("Error loading month:",i)}})},loadWeek(){let t=e.currentWeekStartISO?.()??new Date().toISOString().slice(0,10),a=e.selectedUserId();r(e,{loading:!0,currentWeekStartISO:t}),n.getWeek(t,a).subscribe({next:o=>{r(e,{weekData:o.data,loading:!1})},error:o=>{r(e,{loading:!1}),console.error("Error loading week:",o)}})},toggleMeal(t,a,o){r(e,{loading:!0});let u={dateISO:t,meal:a,optedIn:o};n.toggleMeal(u).subscribe({next:()=>{e.view()==="month"?this.loadMonth():this.loadWeek()},error:i=>{r(e,{loading:!1}),console.error("Error toggling meal:",i)}})}}}),S((e,n=l(M))=>{function t(a){return w(a,{injector:n}).pipe(f())}return{autoLoadMonth:s(p(g(()=>h([t(e.view),t(e.currentMonth),t(e.currentWeekStartISO),t(e.selectedUserId)])),m(()=>e.view()==="month"),d(()=>e.loadMonth()))),autoLoadWeek:s(p(g(()=>h([t(e.view),t(e.currentWeekStartISO),t(e.selectedUserId)])),m(()=>e.view()==="week"),d(()=>e.loadWeek())))}}),W({onInit(e){e.autoLoadMonth(),e.autoLoadWeek()}}));export{H as a};
