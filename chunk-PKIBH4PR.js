import{B as a,P as d,S as c,W as v,_ as l,d as m,dc as k,jc as h,lc as n,mc as S,nc as b,oc as p,p as R,pc as A,q as i,qc as f}from"./chunk-7KD5NMWA.js";var _=`${f.apiUrl}/auth/refresh`,g=class r{http=l(k);apiUrl=f.apiUrl;constructor(){}login(e){return this.http.post(`${this.apiUrl}/auth/login`,e).pipe(c(()=>{}),a(t=>(console.error("Login error:",t),i(()=>t))))}register(e){return this.http.post(`${this.apiUrl}/auth/register`,e).pipe(c(()=>{}),a(t=>(console.error("Registration error:",t),i(()=>t))))}refresh(e){return this.http.post(_,{refresh_token:e})}adminRegister(e){return this.http.post(`${this.apiUrl}/auth/register`,e).pipe(c(()=>{}),a(t=>(console.error("Admin registration error:",t),i(()=>t))))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"})};function E(r,e){switch(r){case"CLIENT":e.navigate(["/"]);break;case"ADMIN":case"DELIVERY":e.navigate(["/clients"]);break;default:e.navigate(["/"]);break}}function U(r,e,t){switch(r){case"CLIENT":e!=="/"&&e!==""&&t.navigate(["/"]);break;case"ADMIN":case"DELIVERY":e!=="/clients"&&e!=="/"&&e!==""&&t.navigate(["/clients"]);break}}var y={user:null,accessToken:null,isAuthenticated:!1,loading:!1,error:null},Q=S({providedIn:"root"},A(y),p((r,e=l(h))=>({_loginSuccess(t){localStorage.setItem("refresh_token",t.refresh_token),localStorage.setItem("auth_user",JSON.stringify(t.user)),sessionStorage.setItem("access_token",t.access_token),n(r,{user:t.user,accessToken:t.access_token,isAuthenticated:!0,loading:!1,error:null}),console.log("Login successful, navigating based on user type..."),E(t.user.userType,e)}})),p(r=>{let e=l(g),t=l(h);return{login(o){n(r,{loading:!0,error:null}),e.login(o).subscribe({next:s=>{r._loginSuccess(s)},error:s=>{n(r,{loading:!1,error:s.error?.message||"Login failed"})}})},register(o){n(r,{loading:!0,error:null}),e.register(o).subscribe({next:s=>{r._loginSuccess(s)},error:s=>{n(r,{loading:!1,error:s.error?.message||"Registration failed"})}})},logout(){localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),sessionStorage.removeItem("access_token"),n(r,{user:null,accessToken:null,isAuthenticated:!1,loading:!1,error:null}),t.navigate(["/login"])},clearError(){n(r,{error:null})},initializeAuth(){return m(this,null,function*(){let o=localStorage.getItem("auth_user"),s=o?JSON.parse(o):null,u=sessionStorage.getItem("access_token");if(u&&sessionStorage.setItem("access_token",u),n(r,{user:s,isAuthenticated:!!u,loading:!1}),s&&u){let I=t.url;U(s.userType,I,t)}})},getAccessToken(){return r.accessToken()},refreshUsingStoredToken(){let o=localStorage.getItem("refresh_token");return o?e.refresh(o).pipe(d(s=>!s?.access_token||!s?.refresh_token?(this.logout(),i(()=>new Error("Invalid refresh token response"))):(r._loginSuccess(s),R(s.access_token))),a(s=>(this.logout(),i(()=>s)))):i(()=>new Error("No refresh token available"))}}}),b({onInit(r){r.initializeAuth()}}));export{_ as a,g as b,Q as c};
